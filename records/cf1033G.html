<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta charset="utf-8">
		<link type="text/css" rel="stylesheet" href="../additional_files/css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="../additional_files/css/sh_typical.min.css">
		<title>[Codeforces1033G]Chip Game</title>
		<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$']], displayMath: [['$$', '$$']]}});</script>
		<script src="../additional_files/js/sh_main.min.js"></script>
		<script src="../additional_files/MathJax-master/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	</head>
	<body>
		<h3>题目描述</h3>
		<p>有 $n$ 堆石子，第 $i$ 堆石子有 $a_i$ 个，Alice 和 Bob 分别有一个数字 $a$ 和 $b$，Alice 一次操作可以从一堆至少有 $a$ 个石子中取走 $a$，Bob 一次操作可以从一堆至少有 $b$ 个石子中取走 $b$ 个。</p>
		<p>当 $a,b$ 确定时，此时的局面只有如下四种可能：Alice 必胜，Bob 必胜，先手必胜，后手必胜。</p>
		<p>求当 $a,b$ 均为不超过 $m$ 的正整数时，这四种情况分别出现了多少次。</p>
		<p>$n\le100$，$m\le10^5$。</p>

		<h3>题解</h3>
		<p>考虑当 $a$ 和 $b$ 确定时，如何判定一个局面是以上四个局面中的哪一个。</p>
		<p>容易发现，如果每个石子堆中石头的个数都对 $a+b$ 取模，答案不变，下面我们来证明这个结论。</p>
		<p>若原先后手必胜：若先手取的石子堆中石头的个数 $\ge a+b$，则后手也取这堆石头，否则按照取模后的策略进行行动，此时后手必胜；</p>
		<p>若原先先手必胜：先手先按原来的策略选取石头，此时若后手取的石子堆中石头的个数 $\ge a+b$，则先手也取这堆石头，否则按照取模后的策略进行行动，此时先手必胜。</p>
		<p>综上所述，我们证明了这个结论。</p>
		<p>不妨设 $a\le b$，若 $a$ 先手，则在取模后，如果存在一堆石头的石头个数 $x$ 满足 $a\le x&lt;b$（此时 Alice 可以取这堆石头而 Bob 不能）或者 $2a\le x$（此时 Alice 先取这堆石头，则转化为了上一种情况）则显然先手必胜。</p>
		<p>否则，所有石头堆的石头的个数 $x$ 均满足 $x&lt;a$ 或 $b\le x&lt;2a$，此时先手获胜当且仅当 $\sum\limits_{i=1}^{n}[a_i\ge b]$ 为奇数，所以我们就得到了此时先手必胜的条件（下列三个中有一个成立即可）：</p>
		<ul>
			<li>$\exists i,a\le a_i&lt;b$；</li>
			<li>$\exists i,2a\le a_i$；</li>
			<li>$2\nmid\sum\limits_{i=1}^{n}[a_i\ge b]$。</li>
		</ul>
		<p>同理，当 $a&lt;b$ 时且 $b$ 先手时，先手必胜当且仅当以下三个条件都成立：</p>
		<ul>
			<li>$\nexists i,a\le a_i&lt;b$；</li>
			<li>$\sum\limits_{i=1}^{n}[2a\le a_i]&lt;2$；</li>
			<li>$2\nmid\sum\limits_{i=1}^{n}[a_i\ge b]$。</li>
		</ul>
		<p>现在考虑原问题：</p>
		<p>容易发现，Alice 必胜的情况和 Bob 必胜的情况是对称的，所以只需分别计算出先手必胜和后手必胜的情况数后再用总情况 $(m^2)$ 减去它们后再除以 $2$ 便能得到上面两种情况的答案。</p>
		<p>由于取模很难处理，所以肯定要先枚举 $a+b$ 的值，此时计算 $a$ 的取值范围。</p>
		<p>由上述知，游戏的结果取决于谁是先手当且仅当（$a&lt;b$）：</p>
		<ul>
			<li>$\nexists i,a\le a_i&lt;b$；</li>
			<li>$\sum\limits_{i=1}^{n}[2a\le a_i]&lt;2$；</li>
			<li>$2\nmid\sum\limits_{i=1}^{n}[a_i\ge b]$。</li>
			<li>$\exists i,a\le a_i&lt;b$ 或 $\exists i,2a\le a_i$ 或 $2\nmid\sum\limits_{i=1}^{n}[a_i\ge b]$。</li>
		</ul>
		<p>即 $\nexists i,a\le a_i&lt;b$ 且 $\sum\limits_{i=1}^{n}[2a\le a_i]&lt;2$ 且 $2\nmid\sum\limits_{i=1}^{n}[a_i\ge b]$。</p>
		<p>同理，取决于谁是后手当且仅当 $\nexists i,a\le a_i&lt;b$ 且 $\sum\limits_{i=1}^{n}[2a\le a_i]&lt;1$ 且 $2\mid\sum\limits_{i=1}^{n}[a_i\ge b]$。</p>
		<p>所以按照取模后的 $a_i$ 对值域划分后，$a$ 和 $b$ 在同一段里，考虑枚举在哪一段，则此时 $\sum\limits_{i=1}^{n}[a_i\ge b]$ 的奇偶性已经确定，第二个限制也可以方便计算，总时间复杂度 $\mathcal{O}(nm)$。</p>

		<h3>代码</h3>

		<div class="panel-body"><pre class="sh_sourceCode"><code class="sh_cpp">#include &lt;bits/stdc++.h&gt;

using namespace std;

const int N = 105, M = 1e5 + 5;

long long a[N];
int b[N];

signed main()
{
    int n, m;
    scanf(&quot;%d%d&quot;, &amp;n, &amp;m);
    for (int i = 1; i &lt;= n; ++i) {
        scanf(&quot;%lld&quot;, &amp;a[i]);
    }
    long long A1 = 0, A2 = 0;
    for (int i = 2; i &lt;= m + m; ++i) {
        for (int j = 1; j &lt;= n; ++j) {
            b[j] = a[j] % i;
        }
        sort(b + 1, b + n + 1);
        b[0] = 0, b[n + 1] = i - 1;
        for (int j = n + 1, now = 0; j; --j, now ^= 1) {
            int l = max(b[j - 1] + 1, b[n - now] / 2 + 1), r = min(b[j], m);
            int L = max(l, i - r), R = min(r, i - l);
            if (L &lt;= R) {
                if (now) {
                    A1 += R - L + 1;
                } else {
                    A2 += R - L + 1;
                }
            }
        }
    }
    printf(&quot;%lld %lld %lld %lld\n&quot;, (1ll * m * m - A1 - A2) / 2, (1ll * m * m - A1 - A2) / 2, A1, A2);
    return 0;
}
</code><script>syntax_highlight()</script>
</pre></div>
	</body>
</html>